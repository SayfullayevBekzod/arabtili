{% extends "base.html" %}
{% load sanitize %}
{% block title %}Progress{% endblock %}
{% block content %}

<!-- Post-Login Quiz Modal - 5 Questions -->
{% if show_daily_quiz or show_welcome_quiz %} <div x-data="{ 
    open: true,
    currentQ: 0,
    score: 0,
    answered: false,
    isCorrect: false,
    finished: false,
    loading: true,
    questions: [],
    
    allQuizQuestions: [
        { question: '\" Kitob\" so\'zining arabcha tarjimasi?', options: ['Kitabun (ÙƒÙØªÙØ§Ø¨ÙŒ)', 'Qalamun (Ù‚ÙÙ„ÙÙ…ÙŒ)'
  , 'Babun (Ø¨ÙØ§Ø¨ÙŒ)' , 'Kursiyyun (ÙƒÙØ±Ù’Ø³ÙÙŠÙŒÙ‘)' ], correct: 0 }, { question: 'Bu harf qanday o\' qiladi: Ø¨', options:
  ['Alif', 'Ba' , 'Ta' , 'Tha' ], correct: 1 }, { question: '\"Salom\" so\' zining arabchasi qaysi?', options:
  ['Ù…ÙØ±Ù’Ø­ÙØ¨Ù‹Ø§', 'Ø³ÙÙ„ÙØ§Ù…ÙŒ' , 'Ø´ÙÙƒÙ’Ø±Ù‹Ø§' , 'Ø£ÙÙ‡Ù’Ù„Ù‹Ø§' ], correct: 1 }, { question: 'Qaysi harf \"Jim\" deb o\' qiladi?',
  options: ['Ø­', 'Ø®' , 'Ø¬' , 'Ø«' ], correct: 2 }, { question: '\"Qalam\" arabchada qanday?' , options:
  ['ÙƒÙØªÙØ§Ø¨ÙŒ', 'Ø¯ÙÙÙ’ØªÙØ±ÙŒ' , 'Ù‚ÙÙ„ÙÙ…ÙŒ' , 'Ù…ÙØ³Ù’Ø·ÙØ±ÙØ©ÙŒ' ], correct: 2 }, { question: '\"Olma\" (Tuffahun) so\' zini toping?',
  options: ['ØªÙÙÙ‘ÙØ§Ø­ÙŒ', 'Ø¹ÙÙ†ÙØ¨ÙŒ' , 'Ù…ÙÙˆÙ’Ø²ÙŒ' , 'Ø¨ÙØ±Ù’ØªÙÙ‚ÙØ§Ù„ÙŒ' ], correct: 0 }, { question: '\"Maktab\" so\' zining
  ma\'nosi?', options: ['Kutubxona', 'Maktab' , 'Uy' , 'Bog\''], correct: 1 },
        { question: ' Qaysi harf \"Shin\"?', options: ['Ø³', 'Ø´' , 'Øµ' , 'Ø¶' ], correct: 1 }, {
  question: '\"Suv\" (Maun) arabchada?' , options: ['Ù„ÙØ¨ÙÙ†ÙŒ', 'Ù…ÙØ§Ø¡ÙŒ' , 'Ø¹ÙØµÙÙŠØ±ÙŒ' , 'Ø´ÙØ§ÙŠÙŒ' ], correct: 1 }, {
  question: '\"Xush kelibsiz\" arabchada nima?' , options: ['Ø£ÙÙ‡Ù’Ù„Ù‹Ø§ ÙˆÙØ³ÙÙ‡Ù’Ù„Ù‹Ø§', 'ÙˆÙØ¯ÙØ§Ø¹Ù‹Ø§' , 'Ø´ÙÙƒÙ’Ø±Ù‹Ø§' , 'Ø¹ÙÙÙ’ÙˆÙ‹Ø§' ],
  correct: 0 }, { question: '\"Oshxona\" (Matbaxun) qaysi?' , options: ['ØºÙØ±Ù’ÙÙØ©ÙŒ', 'Ø­ÙÙ…Ù‘ÙØ§Ù…ÙŒ' , 'Ù…ÙØ·Ù’Ø¨ÙØ®ÙŒ' , 'Ø¨ÙÙŠÙ’ØªÙŒ'
  ], correct: 2 }, { question: 'Qaysi raqam \"Isnan\" (2)?' , options: ['Ù¡', 'Ù¢' , 'Ù£' , 'Ù¤' ], correct: 1 }, {
  question: '\"Non\" (Xubzun) arabchada?' , options: ['Ø®ÙØ¨Ù’Ø²ÙŒ', 'Ù„ÙØ­Ù’Ù…ÙŒ' , 'Ø£ÙØ±ÙØ²Ù‘ÙŒ' , 'Ø³ÙÙ…ÙÙƒÙŒ' ], correct: 0 }, {
  question: '\"Katta\" (Kabir) so\' zining teskarisi?', options: ['Ø¬ÙÙ…ÙÙŠÙ„ÙŒ', 'Ù‚ÙØ¯ÙÙŠÙ…ÙŒ' , 'ØµÙØºÙÙŠØ±ÙŒ' , 'Ø³ÙØ±ÙÙŠØ¹ÙŒ' ],
  correct: 2 }, { question: '\"Rahmat\"ga javob nima?' , options: ['Ø¹ÙÙÙ’ÙˆÙ‹Ø§', 'Ø£ÙÙ‡Ù’Ù„Ù‹Ø§' , 'Ø³ÙÙ„ÙØ§Ù…ÙŒ' , 'Ù…ÙØ±Ù’Ø­ÙØ¨Ù‹Ø§' ],
  correct: 0 }, { question: 'Qaysi harf \"Zo\"?' , options: ['Ø·', 'Ø¸' , 'Øµ' , 'Ø¶' ], correct: 1 }, {
  question: '\"Quyosh\" (Shams) so\' zini toping?', options: ['Ù‚ÙÙ…ÙØ±ÙŒ', 'Ù†ÙØ¬Ù’Ù…ÙŒ' , 'Ø´ÙÙ…Ù’Ø³ÙŒ' , 'Ø³ÙÙ…ÙØ§Ø¡ÙŒ' ], correct: 2 },
  { question: '\"Oq\" (Abyad) rangini tanlang?' , options: ['Ø£ÙØ³Ù’ÙˆÙØ¯Ù', 'Ø£ÙØ¨Ù’ÙŠÙØ¶Ù' , 'Ø£ÙØ­Ù’Ù…ÙØ±Ù' , 'Ø£ÙØ²Ù’Ø±ÙÙ‚Ù' ], correct:
  1 }, { question: '\"Mushuk\" (Qitun) arabchada?' , options: ['Ù‚ÙØ·Ù‘ÙŒ', 'ÙƒÙÙ„Ù’Ø¨ÙŒ' , 'Ø£ÙØ³ÙØ¯ÙŒ' , 'ÙÙÙŠÙ„ÙŒ' ], correct: 0 }, {
  question: '\"Daftar\" so\' zini tanlang?', options: ['ÙƒÙØªÙØ§Ø¨ÙŒ', 'Ø¯ÙÙÙ’ØªÙØ±ÙŒ' , 'Ù‚ÙÙ„ÙÙ…ÙŒ' , 'Ù…ÙØ±Ù’Ø³ÙÙ…ÙŒ' ], correct: 1 } ],
  init() { // Pick 5 random questions const shuffled=[...this.allQuizQuestions].sort(()=> 0.5 - Math.random());
  this.questions = shuffled.slice(0, 5);
  this.loading = false;
  },

  selectAnswer(idx) {
  if (this.answered) return;
  this.answered = true;
  this.isCorrect = idx === this.questions[this.currentQ].correct;
  if (this.isCorrect) this.score++;

  setTimeout(() => {
  if (this.currentQ < this.questions.length - 1) { this.currentQ++; this.answered=false; this.isCorrect=false; } else {
    this.finished=true; this.saveResult(); } }, 1000); }, async saveResult() { try { await fetch('/api/quiz/result/', {
    method: 'POST' , headers: { 'Content-Type' : 'application/json' , 'X-CSRFToken' : '{{ csrf_token }}' }, body:
    JSON.stringify({ correct: this.score>= 3, score: this.score, total: this.questions.length })
    });
    } catch (err) { console.error('Quiz save:', err); }
    }
    }
    " x-init="init()" x-show="open" class="fixed inset-0 z-[200] flex items-center justify-center px-4" style="display:
    none;">
    <div class="absolute inset-0 bg-slate-950/80 backdrop-blur-sm" @click="open = false"></div>
    <div class="relative w-full max-w-lg rounded-3xl border border-emerald-500/20 bg-slate-900 p-6 shadow-2xl">

      <!-- Loading State -->
      <div x-show="loading" class="py-12 flex flex-col items-center justify-center space-y-4">
        <div class="relative">
          <div class="h-16 w-16 rounded-2xl bg-emerald-500/20 flex items-center justify-center animate-pulse">
            <i class="fas fa-robot text-2xl text-emerald-400"></i>
          </div>
          <template x-if="!aiErrorMessage">
            <div class="absolute -inset-2 border border-emerald-500/30 rounded-3xl animate-spin"></div>
          </template>
        </div>
        <div class="text-center px-4">
          <template x-if="!aiErrorMessage">
            <div>
              <p class="text-white font-bold text-sm uppercase tracking-widest">AI Savollar Tuzilmoqda</p>
              <p class="text-slate-500 text-[10px] uppercase mt-1">Siz uchun maxsus test tayyorlanyapti...</p>
            </div>
          </template>
          <template x-if="aiErrorMessage">
            <div>
              <p class="text-red-400 font-bold text-sm uppercase tracking-widest">AI Band</p>
              <p class="text-slate-400 text-[10px] mt-1" x-text="aiErrorMessage"></p>
              <button @click="loading = false; aiErrorMessage = ''"
                class="mt-4 px-6 py-2 rounded-xl bg-white text-slate-950 text-[10px] font-bold uppercase tracking-widest">
                Davom etish
              </button>
            </div>
          </template>
        </div>
      </div>

      <!-- Progress Bar -->
      <div class="mb-6" x-show="!finished && !loading">
        <div class="flex items-center justify-between text-xs text-slate-400 mb-2">
          <span>Savol <span x-text="currentQ + 1"></span> / <span x-text="questions.length"></span></span>
          <span class="text-emerald-400"><span x-text="score"></span> to'g'ri</span>
        </div>
        <div class="h-2 bg-slate-800 rounded-full overflow-hidden">
          <div class="h-full bg-gradient-to-r from-emerald-500 to-sky-500 transition-all duration-300"
            :style="`width: ${((currentQ) / questions.length) * 100}%`"></div>
        </div>
      </div>

      <!-- Question State -->
      <div class="text-center" x-show="!finished && !loading">
        <div
          class="inline-flex h-14 w-14 items-center justify-center rounded-2xl bg-emerald-500/10 text-2xl text-emerald-400 mb-4">
          ğŸ§ 
        </div>
        <h2 class="text-xl font-black text-white" x-text="show_welcome_quiz ? 'Xush kelibsiz!' : 'Kun savollari!'"></h2>
        <p class="mt-1 text-slate-400 text-sm"
          x-text="show_welcome_quiz ? 'Bilimingizni sinab ko\'ramiz' : '5 ta savolga javob bering'"></p>
      </div>

      <!-- Question -->
      <div class="mt-6 space-y-3" x-show="!finished">
        <div class="text-lg font-bold text-center text-white mb-4 arabic-font" x-text="questions[currentQ].question">
        </div>

        <template x-for="(option, idx) in questions[currentQ].options" :key="idx">
          <button @click="selectAnswer(idx)" :class="{
            'bg-emerald-500/30 border-emerald-500': answered && idx === questions[currentQ].correct,
            'bg-red-500/30 border-red-500': answered && isCorrect === false && idx !== questions[currentQ].correct && idx === questions[currentQ].options.indexOf(questions[currentQ].options.find((o, i) => i === idx)),
            'bg-white/5 border-white/10 hover:bg-white/10': !answered
          }" :disabled="answered" class="w-full rounded-2xl border p-4 text-left transition flex items-center gap-3">
            <span class="w-8 h-8 rounded-lg flex items-center justify-center text-xs font-black"
              :class="answered && idx === questions[currentQ].correct ? 'bg-emerald-500 text-white' : 'bg-white/10 text-slate-400'"
              x-text="['A', 'B', 'C', 'D'][idx]"></span>
            <span class="font-bold text-slate-300" x-text="option"></span>
          </button>
        </template>
      </div>

      <!-- Result State -->
      <div class="text-center py-6" x-show="finished" style="display: none;">
        <div class="inline-flex h-24 w-24 items-center justify-center rounded-full mb-4 text-5xl"
          :class="score >= 3 ? 'bg-emerald-500/10' : 'bg-amber-500/10'">
          <span x-text="score >= 4 ? 'ğŸ†' : score >= 3 ? 'ğŸ‘' : 'ğŸ’ª'"></span>
        </div>
        <h2 class="text-3xl font-black text-white">
          <span x-text="score"></span>/<span x-text="questions.length"></span>
        </h2>
        <p class="mt-2 text-slate-400"
          x-text="score >= 4 ? 'Ajoyib natija! +20 XP' : score >= 3 ? 'Yaxshi! +10 XP' : 'Davom eting!'"></p>

        <div class="mt-6 flex justify-center gap-3">
          <button @click="open = false"
            class="px-8 py-3 rounded-2xl bg-gradient-to-r from-emerald-500 to-sky-500 text-slate-950 font-bold hover:opacity-90 transition">
            Davom etish
          </button>
        </div>
      </div>

      <button @click="open = false" x-show="!finished"
        class="mt-6 w-full py-3 text-xs font-bold text-slate-500 hover:text-white transition uppercase tracking-widest">
        O'tkazib yuborish
      </button>
    </div>
</div>
{% endif %}

<!-- HERO -->
<section
  class="relative overflow-hidden rounded-[2.5rem] border border-white/10 bg-slate-900/40 backdrop-blur-xl p-6 md:p-12 shadow-2xl">
  <div
    class="pointer-events-none absolute -top-40 -left-40 h-[500px] w-[500px] rounded-full bg-emerald-500/10 blur-[120px]">
  </div>
  <div
    class="pointer-events-none absolute -bottom-40 -right-40 h-[500px] w-[500px] rounded-full bg-sky-500/10 blur-[120px]">
  </div>

  <div class="relative z-10 flex flex-col lg:flex-row lg:items-center justify-between gap-8">
    <div class="flex-1">
      <div
        class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-emerald-500/10 border border-emerald-500/20 text-[10px] font-black uppercase tracking-widest text-emerald-400 mb-4">
        Account â€¢ Dashboard
      </div>
      <h1 class="text-4xl md:text-6xl font-black text-white tracking-tight">ğŸ“Š Progress</h1>
      <p class="mt-4 text-slate-400 text-sm md:text-base max-w-xl leading-relaxed">
        Sizning natijangiz: streak, review, soâ€˜z boyligi, darslar va odatlar.
      </p>

      <div class="mt-6 flex flex-wrap gap-3">
        <span
          class="flex items-center gap-2 px-4 py-2 rounded-2xl bg-white/5 border border-white/10 text-xs font-bold text-slate-300">
          <i class="fas fa-check-circle text-emerald-400 text-[10px]"></i> Daily
        </span>
        <span
          class="flex items-center gap-2 px-4 py-2 rounded-2xl bg-white/5 border border-white/10 text-xs font-bold text-slate-300">
          <i class="fas fa-check-circle text-emerald-400 text-[10px]"></i> Review
        </span>
        <span
          class="flex items-center gap-2 px-4 py-2 rounded-2xl bg-white/5 border border-white/10 text-xs font-bold text-slate-300">
          <i class="fas fa-check-circle text-emerald-400 text-[10px]"></i> Lessons
        </span>
      </div>
    </div>

    <div class="flex flex-wrap items-center gap-3">
      <a href="/roadmap/"
        class="flex-1 sm:flex-none flex items-center justify-center gap-2 px-6 py-3 rounded-2xl bg-emerald-500 text-slate-950 font-bold text-sm hover:bg-emerald-400 transition-all active:scale-95">
        ğŸ—º Roadmap
      </a>
      <a href="/review/"
        class="flex-1 sm:flex-none flex items-center justify-center gap-2 px-6 py-3 rounded-2xl bg-white/10 border border-white/10 text-white font-bold text-sm hover:bg-white/20 transition-all active:scale-95">
        ğŸ§  Review
      </a>
      <a href="/accounts/logout/"
        class="w-full sm:w-auto flex items-center justify-center px-6 py-3 rounded-2xl bg-red-500/10 border border-red-500/20 text-red-500 font-bold text-sm hover:bg-red-500 hover:text-white transition-all">
        Chiqish
      </a>
    </div>
  </div>
</section>

<!-- MISSIONS (Phae 2) -->
<div class="mt-6">
  <div class="flex items-center justify-between px-2 mb-4">
    <h3 class="text-xl font-black flex items-center gap-2">
      ğŸš€ Kunlik Missiyalar
      <span class="text-xs font-normal text-slate-400 bg-white/5 px-2 py-1 rounded-full">Yangi XP olish</span>
    </h3>
  </div>
  <div class="grid md:grid-cols-3 gap-4">
    {% for m in missions %}
    <div
      class="group relative overflow-hidden rounded-3xl border border-white/10 bg-white/5 p-5 transition hover:bg-white/10">
      <div class="flex items-start justify-between">
        <div>
          <div class="text-xs text-emerald-400 font-bold uppercase tracking-wider">
            {{ m.mission.get_mission_type_display }}
          </div>
          <div class="mt-1 text-lg font-bold">{{ m.mission.title }}</div>
          <div class="text-xs text-slate-400 mt-1">{{ m.mission.description }}</div>
        </div>
        <div class="text-xl">
          {% if m.mission.mission_type == 'lesson' %} ğŸ“
          {% elif m.mission.mission_type == 'word' %}
          ğŸ“š
          {% elif m.mission.mission_type == 'review' %}
          ğŸ§ 
          {% else %}
          âš¡
          {% endif %}
        </div>
      </div>
      <div class="mt-4">
        <div class="flex items-center justify-between text-[10px] text-slate-400 mb-1">
          <span>Progress</span>
          <span>{{ m.current_progress }} / {{ m.mission.required_count }}</span>
        </div>
        <div class="h-1.5 rounded-full bg-white/5 overflow-hidden">
          <div class="h-full bg-emerald-400 transition-all duration-500"
            style="width: {% widthratio m.current_progress m.mission.required_count 100 %}%"></div>
        </div>
      </div>
      <div class="mt-4 flex items-center justify-between">
        <span class="text-xs font-bold text-slate-200">+{{ m.mission.xp_reward }} XP</span>
        {% if m.is_completed %} <span class="text-[10px] bg-emerald-500/20 text-emerald-400 px-2 py-1 rounded-full font-bold">Bajarildi âœ…</span>
        {% else %}
        <span class="text-[10px] bg-white/5 text-slate-400 px-2 py-1 rounded-full">Davom etmoqda...</span>
        {% endif %}
      </div>
    </div>
    {% empty %}
    <div class="col-span-full py-10 text-center rounded-3xl border border-dashed border-white/10 bg-white/5">
      <div class="text-slate-400 text-sm">Hozircha missiyalar yo'q.</div>
    </div>
    {% endfor %}
  </div>
</div>

<!-- TOP: DAILY PLAN + LEVEL/XP + STUDY TIME -->
<div class="mt-6 grid lg:grid-cols-3 gap-4">

  <!-- Daily Plan -->
  <div class="rounded-3xl border border-white/10 bg-white/5 p-6">
    <div class="flex items-start justify-between gap-3">
      <div>
        <div class="text-sm text-slate-400">ğŸ¯ Bugungi reja</div>
        <div class="mt-1 text-2xl font-black">Daily plan</div>
        <div class="text-xs text-slate-400 mt-1">Kichik qadamlar â€” katta natija.</div>
      </div>
      <div class="h-12 w-12 rounded-2xl border border-white/10 bg-slate-950/40 grid place-items-center">ğŸ¯</div>
    </div>

    <div class="mt-5 space-y-2 text-sm">
      <div class="flex items-center justify-between rounded-2xl border border-white/10 bg-slate-950/30 px-4 py-3">
        <div class="text-slate-300">ğŸ§  Review</div>
        <div class="text-slate-400 text-xs">
          {% if today_review_done is not None %}{{ today_review_done }}{% else %}0{% endif %} / {% if daily_review_target is not None %}{{ daily_review_target }}{% else %}10{% endif %} </div>
      </div>
      <div class="flex items-center justify-between rounded-2xl border border-white/10 bg-slate-950/30 px-4 py-3">
        <div class="text-slate-300">ğŸ“š Yangi soâ€˜z</div>
        <div class="text-slate-400 text-xs">
          {{ today_new_words|default:0 }} / {{ daily_new_words_target|default:5 }}
        </div>
      </div>
      <div class="flex items-center justify-between rounded-2xl border border-white/10 bg-slate-950/30 px-4 py-3">
        <div class="text-slate-300">ğŸ“ Dars</div>
        <div class="text-slate-400 text-xs">
          {{ today_lessons_done|default:0 }} / {{ daily_lessons_target|default:1 }}
        </div>
      </div>
    </div>

    <div class="mt-5 flex flex-wrap gap-2 text-xs">
      <a href="/review/"
        class="rounded-2xl border border-white/10 bg-white/5 px-4 py-2 hover:bg-white/10 transition">Review</a>
      <a href="/dictionary/"
        class="rounded-2xl border border-white/10 bg-white/5 px-4 py-2 hover:bg-white/10 transition">Soâ€˜zlar</a>
      <a href="/courses/"
        class="rounded-2xl border border-white/10 bg-white/5 px-4 py-2 hover:bg-white/10 transition">Dars</a>
    </div>
  </div>

  <!-- Level / XP -->
  <div class="rounded-3xl border border-white/10 bg-white/5 p-6">
    <div class="flex items-start justify-between gap-3">
      <div>
        <div class="text-sm text-slate-400">ğŸ§© Level / XP</div>
        <div class="mt-1 text-2xl font-black">Level {% if level %}{{ level }}{% else %}1{% endif %}</div> <div class="text-xs text-slate-400 mt-1">
          XP: <span class="text-slate-200 font-semibold">{% if xp is not None %}{{ xp }}{% else %}0{% endif %}</span> / {% if xp_next %}{{ xp_next }}{% else %}100{% endif %} </div>
      </div>
      <div class="h-12 w-12 rounded-2xl border border-white/10 bg-slate-950/40 grid place-items-center">ğŸ§©</div>
    </div>

    <div class="mt-5 h-2 rounded-full bg-white/10 overflow-hidden">
      <div class="h-2 bg-gradient-to-r from-emerald-400 to-sky-400"
        style="width: {% if xp_pct is not None %}{{ xp_pct }}{% else %}0{% endif %}%"></div> </div>

    <div class="mt-4 text-xs text-slate-400">
      Next level uchun: <span class="text-slate-200 font-semibold">{% if xp_remaining is not None %}{{ xp_remaining }}{% else %}0{% endif %}</span> XP kerak.
    </div>

    <div class="mt-5 rounded-2xl border border-white/10 bg-slate-950/30 p-4">
      <div class="text-sm text-slate-300 font-semibold">âš¡ Tez XP olish</div>
      <div class="mt-2 text-xs text-slate-400 space-y-1">
        <div>â€¢ Review: +1 XP/card</div>
        <div>â€¢ Lesson: +10 XP</div>
        <div>â€¢ New word: +2 XP</div>
      </div>
    </div>
  </div>

  <!-- Study Time -->
  <div class="rounded-3xl border border-white/10 bg-white/5 p-6">
    <div class="flex items-start justify-between gap-3">
      <div>
        <div class="text-sm text-slate-400">â± Study time</div>
        <div class="mt-1 text-2xl font-black">{% if study_today_min is not None %}{{ study_today_min }}{% else %}0{% endif %} min</div>
        <div class="text-xs text-slate-400 mt-1">Bugun oâ€˜qigan vaqt</div>
      </div>
      <div class="h-12 w-12 rounded-2xl border border-white/10 bg-slate-950/40 grid place-items-center">â±</div>
    </div>

    <div class="mt-5 grid grid-cols-2 gap-3 text-sm">
      <div class="rounded-2xl border border-white/10 bg-slate-950/30 p-4">
        <div class="text-xs text-slate-400">Haftada</div>
        <div class="mt-1 text-xl font-black">{% if study_week_min is not None %}{{ study_week_min }}{% else %}0{% endif %} min</div>
      </div>
      <div class="rounded-2xl border border-white/10 bg-slate-950/30 p-4">
        <div class="text-xs text-slate-400">Oâ€˜rtacha</div>
        <div class="mt-1 text-xl font-black">{% if study_avg_min is not None %}{{ study_avg_min }}{% else %}0{% endif %} min/kun</div>
      </div>
    </div>

    <div class="mt-4 text-xs text-slate-400">
      Tip: â€œ2Ã—5â€ qoida â€” kuniga 2 marta 5 daqiqa ham kuchli odat.
    </div>
  </div>

</div>

<!-- STATS (sizniki) -->
<div class="mt-6 grid md:grid-cols-3 gap-4">

  <!-- Streak -->
  <div class="group relative overflow-hidden rounded-3xl border border-white/10 bg-white/5 p-6
              transition-all duration-300 hover:bg-white/10 hover:-translate-y-1 hover:border-white/20">
    <span class="pointer-events-none absolute inset-0 opacity-0 group-hover:opacity-100 transition
                 bg-gradient-to-tr from-transparent via-white/10 to-transparent"></span>

    <div class="flex items-start justify-between">
      <div>
        <div class="text-sm text-slate-400">ğŸ”¥ Streak</div>
        <div class="mt-2 text-4xl font-black text-white">{{ streak.current_streak }}</div>
        <div class="text-xs text-slate-400 mt-1">Best: <span class="text-slate-200 font-semibold">
            {{ streak.best_streak }}
          </span></div>
      </div>
      <div class="h-12 w-12 rounded-2xl border border-white/10 bg-slate-950/40 grid place-items-center">
        <span class="text-xl">ğŸ”¥</span>
      </div>
    </div>

    <div class="mt-5 text-xs text-slate-400">
      Tip: har kuni 10 daqiqa ham boâ€˜lsa â€” streak uzilmaydi.
    </div>
  </div>

  <!-- Review -->
  <div class="group relative overflow-hidden rounded-3xl border border-white/10 bg-white/5 p-6
              transition-all duration-300 hover:bg-white/10 hover:-translate-y-1 hover:border-white/20">
    <span class="pointer-events-none absolute inset-0 opacity-0 group-hover:opacity-100 transition
                 bg-gradient-to-tr from-transparent via-white/10 to-transparent"></span>

    <div class="flex items-start justify-between">
      <div>
        <div class="text-sm text-slate-400">ğŸ§  Review</div>
        <div class="mt-2 text-4xl font-black text-white">{{ due_count }}</div>
        <div class="text-xs text-slate-400 mt-1">Due cards</div>
      </div>
      <div class="h-12 w-12 rounded-2xl border border-white/10 bg-slate-950/40 grid place-items-center">
        <span class="text-xl">ğŸ§ </span>
      </div>
    </div>

    <a href="/review/" class="mt-5 inline-flex items-center gap-2 rounded-2xl border border-white/10 bg-white/5 px-4 py-2 text-sm
              hover:bg-white/10 transition">
      Review qilish <span class="transition group-hover:translate-x-1">â†’</span>
    </a>
  </div>

  <!-- Words -->
  <div class="group relative overflow-hidden rounded-3xl border border-white/10 bg-white/5 p-6
              transition-all duration-300 hover:bg-white/10 hover:-translate-y-1 hover:border-white/20">
    <span class="pointer-events-none absolute inset-0 opacity-0 group-hover:opacity-100 transition
                 bg-gradient-to-tr from-transparent via-white/10 to-transparent"></span>

    <div class="flex items-start justify-between">
      <div>
        <div class="text-sm text-slate-400">ğŸ“š Soâ€˜zlar</div>
        <div class="mt-2 text-3xl font-black text-white">
          {{ learned_words }} <span class="text-slate-400">/ {{ total_words }}</span>
        </div>
        <div class="text-xs text-slate-400 mt-1">{{ words_pct }}%</div>
      </div>
      <div class="h-12 w-12 rounded-2xl border border-white/10 bg-slate-950/40 grid place-items-center">
        <span class="text-xl">ğŸ“š</span>
      </div>
    </div>

    <div class="mt-5 h-2 rounded-full bg-white/10 overflow-hidden">
      <div class="h-2 bg-gradient-to-r from-emerald-400 to-sky-400"
        style="width: {% if words_pct is not None %}{{ words_pct }}{% else %}0{% endif %}%"></div> </div>

    <div class="mt-4 text-xs text-slate-400">
      Tip: har kuni 5 ta yangi soâ€˜z + 10 ta review.
    </div>
  </div>

</div>

<!-- WEEKLY CHART + NEXT ACTIONS -->
<div class="mt-4 grid lg:grid-cols-2 gap-4">

  <!-- Weekly chart -->
  <div class="rounded-3xl border border-white/10 bg-white/5 p-6 md:p-7">
    <div class="flex items-center justify-between">
      <div>
        <div class="text-sm text-slate-400">ğŸ“ˆ Oxirgi 7 kun</div>
        <div class="mt-1 text-2xl font-black">Haftalik aktivlik</div>
      </div>
      <div class="rounded-2xl border border-white/10 bg-slate-950/40 px-4 py-2 text-xs text-slate-300">
        Total: {% if week_total_actions is not None %}{{ week_total_actions }}{% else %}0{% endif %} </div>
    </div>

    <div class="mt-6 grid grid-cols-7 gap-2 items-end">
      {% for d in week_bars %}
      <div class="flex flex-col items-center gap-2">
        <div class="w-full rounded-2xl bg-white/10 overflow-hidden h-28 flex items-end">
          <div class="w-full bg-gradient-to-t from-emerald-400/90 to-sky-400/70"
            style="height: {% if d.pct is not None %}{{ d.pct }}{% else %}0{% endif %}%"> </div>
        </div>
        <div class="text-[10px] text-slate-400">{% if d.label %}{{ d.label|safe_text }}{% else %}-{% endif %}</div> </div>
      {% endfor %}
    </div>

    <div class="mt-4 text-xs text-slate-400">
      Tip: har kuni ozgina harakat â€” grafikni â€œbarqarorâ€ qiladi.
    </div>
  </div>

  <!-- Next actions -->
  <div class="rounded-3xl border border-white/10 bg-white/5 p-6 md:p-7">
    <div class="flex items-center justify-between">
      <div>
        <div class="text-sm text-slate-400">ğŸ‘‰ Keyingi qadam</div>
        <div class="mt-1 text-2xl font-black">Tavsiya</div>
      </div>
      <div class="h-10 w-10 rounded-2xl border border-white/10 bg-slate-950/40 grid place-items-center">ğŸ‘‰</div>
    </div>

    <div class="mt-5 space-y-2">
      {% for r in recommendations %}
      <a href="{{ r.url }}"
        class="block rounded-2xl border border-white/10 bg-slate-950/30 px-4 py-3 hover:bg-white/10 transition">
        <div class="flex items-center justify-between gap-3">
          <div class="text-sm text-slate-200 font-semibold">{{ r.title }}</div>
          <div class="text-xs text-slate-400">â†’</div>
        </div>
        <div class="text-xs text-slate-400 mt-1">{{ r.desc }}</div>
      </a>
      {% empty %}
      <div class="rounded-2xl border border-white/10 bg-slate-950/30 p-4 text-sm text-slate-300">
        Hozircha tavsiya yoâ€˜q. Review yoki kursdan davom eting ğŸ™‚
      </div>
      {% endfor %}
    </div>
  </div>

</div>

<!-- LESSONS (sizniki) -->
<div class="mt-4 rounded-3xl border border-white/10 bg-white/5 p-6 md:p-7">
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
    <div>
      <div class="text-sm text-slate-400">ğŸ“ Darslar</div>
      <div class="mt-1 text-2xl md:text-3xl font-black text-white">
        {{ lessons_completed }} <span class="text-slate-400">/ {{ lessons_total }}</span>
      </div>
    </div>

    <div class="rounded-2xl border border-white/10 bg-slate-950/40 px-4 py-2 text-xs text-slate-300">
      {{ lessons_pct }}%
    </div>
  </div>

  <div class="mt-4 h-2 rounded-full bg-white/10 overflow-hidden">
    <div class="h-2 bg-white" style="width: {% if lessons_pct is not None %}{{ lessons_pct }}{% else %}0{% endif %}%"> </div>
  </div>

  <div class="mt-5 flex flex-wrap gap-2 text-xs">
    <a href="/courses/" class="rounded-2xl border border-white/10 bg-white/5 px-4 py-2 hover:bg-white/10 transition">
      Kurslarga oâ€˜tish
    </a>
    <a href="/practice/" class="rounded-2xl border border-white/10 bg-white/5 px-4 py-2 hover:bg-white/10 transition">
      Practice
    </a>
    <a href="/dictionary/" class="rounded-2xl border border-white/10 bg-white/5 px-4 py-2 hover:bg-white/10 transition">
      Lugâ€˜at
    </a>
  </div>
</div>

<!-- ACHIEVEMENTS + WEAK AREAS + HEATMAP -->
<div class="mt-4 grid lg:grid-cols-3 gap-4">

  <!-- Achievements -->
  <div class="rounded-3xl border border-white/10 bg-white/5 p-6">
    <div class="flex items-center justify-between">
      <div>
        <div class="text-sm text-slate-400">ğŸ… Achievements</div>
        <div class="mt-1 text-2xl font-black">Badgeâ€™lar</div>
      </div>
      <div class="h-10 w-10 rounded-2xl border border-white/10 bg-slate-950/40 grid place-items-center">ğŸ…</div>
    </div>

    <div class="mt-5 flex flex-wrap gap-2">
      {% for a in achievements %}
      <span class="rounded-2xl border border-white/10 bg-slate-950/30 px-3 py-2 text-xs text-slate-200">
        {% if a.icon %}{{ a.icon|safe_text }}{% else %}âœ…{% endif %} {{ a.title|safe_text }} </span>
      {% empty %}
      <div class="text-sm text-slate-400">Hozircha badge yoâ€˜q. Birinchi streakni boshlang ğŸ”¥</div>
      {% endfor %}
    </div>
  </div>

  <!-- Weak Areas -->
  <div class="rounded-3xl border border-white/10 bg-white/5 p-6">
    <div class="flex items-center justify-between">
      <div>
        <div class="text-sm text-slate-400">ğŸ§  Qiyin joylar</div>
        <div class="mt-1 text-2xl font-black">Weak areas</div>
      </div>
      <div class="h-10 w-10 rounded-2xl border border-white/10 bg-slate-950/40 grid place-items-center">ğŸ§ </div>
    </div>

    <div class="mt-5 space-y-3">
      {% for w in weak_areas %}
      <div class="rounded-2xl border border-white/10 bg-slate-950/30 p-4">
        <div class="flex items-center justify-between">
          <div class="text-sm text-slate-200 font-semibold">{{ w.title }}</div>
          <div class="text-xs text-slate-400">{{ w.pct }}%</div>
        </div>
        <div class="mt-2 h-2 rounded-full bg-white/10 overflow-hidden">
          <div class="h-2 bg-gradient-to-r from-fuchsia-400/80 to-sky-400/70" style="width: {{ w.pct }}%"></div>
        </div>
        {% if w.url %} <a href="{{ w.url }}" class="mt-3 inline-flex text-xs text-slate-300 hover:text-white transition">Mashq qilish
          â†’</a>
        {% endif %}
      </div>
      {% empty %}
      <div class="text-sm text-slate-400">Qiyin joylar aniqlanmadi. Zoâ€˜r ketayapsiz ğŸ˜„</div>
      {% endfor %}
    </div>
  </div>

  <!-- Heatmap -->
  <div class="rounded-3xl border border-white/10 bg-white/5 p-6">
    <div class="flex items-center justify-between">
      <div>
        <div class="text-sm text-slate-400">ğŸ—“ Activity</div>
        <div class="mt-1 text-2xl font-black">Heatmap</div>
      </div>
      <div class="h-10 w-10 rounded-2xl border border-white/10 bg-slate-950/40 grid place-items-center">ğŸ—“</div>
    </div>

    <div class="mt-5 space-y-2">
      {% for week in heatmap %}
      <div class="flex gap-1">
        {% for c in week %}
        <span class="h-3 w-3 rounded-[4px] border border-white/10"
          style="background: rgba(16, 185, 129, {% if c is not None %}{{ c }}{% else %}0{% endif %})" title="activity"></span>
        {% endfor %}
      </div>
      {% endfor %}
    </div>

    <div class="mt-4 text-xs text-slate-400">
      Tip: ketma-ket kunlar koâ€˜paygani sari odat mustahkamlanadi.
    </div>
  </div>

</div>

{% endblock %}