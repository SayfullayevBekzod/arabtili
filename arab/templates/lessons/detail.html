{% extends "base.html" %}
{% block title %}{{ lesson.title }}{% endblock %}
{% block content %}

<section class="rounded-3xl border border-white/10 bg-white/5 p-6">
  <div class="flex items-start justify-between gap-4">
    <div>
      <div class="text-xs text-slate-400">Lesson ‚Ä¢ {{ lesson.estimated_minutes }} min</div>
      <h1 class="mt-1 text-3xl font-black">{{ lesson.title }}</h1>
      <div class="mt-2 text-slate-300 text-sm">{{ lesson.unit.title }} ‚Ä¢ {{ lesson.unit.course.title }}</div>
    </div>
    <a href="/courses/{{ lesson.unit.course.id }}/" class="text-sm text-slate-300 hover:text-white">‚Üê Kursga qaytish</a>
  </div>
</section>

<div class="mt-6 grid lg:grid-cols-3 gap-4">

  <!-- LEFT: Theory + Sections -->
  <div class="lg:col-span-2 space-y-4">

    <section class="rounded-3xl border border-white/10 bg-white/5 p-6">
      <h2 class="text-lg font-bold">üìò Theory</h2>
      {% if lesson.theory %}
        <div class="mt-3 text-slate-200 leading-relaxed whitespace-pre-line">{{ lesson.theory }}</div>
      {% else %}
        <div class="mt-3 text-slate-400 text-sm">Hali theory qo‚Äòshilmagan.</div>
      {% endif %}
    </section>

    <section class="rounded-3xl border border-white/10 bg-white/5 p-6">
      <div class="flex items-center justify-between">
        <h2 class="text-lg font-bold">üß© Sections</h2>
        <span class="text-xs text-slate-400">{{ lesson.sections.count }} ta</span>
      </div>

      <div class="mt-4 space-y-3">
        {% for s in lesson.sections.all %}
          <div class="rounded-2xl border border-white/10 bg-black/20 p-4">
            <div class="font-semibold">{{ s.order }}. {{ s.title }}</div>
            <div class="mt-2 text-slate-200 text-sm whitespace-pre-line">{{ s.content }}</div>
          </div>
        {% empty %}
          <div class="text-slate-400 text-sm">Section yo‚Äòq.</div>
        {% endfor %}
      </div>
    </section>

  </div>

  <!-- RIGHT: Words + Exercises -->
  <div class="space-y-4">

    <section class="rounded-3xl border border-white/10 bg-white/5 p-6">
      <div class="flex items-center justify-between">
        <h2 class="text-lg font-bold">üìö Words</h2>
        <span class="text-xs text-slate-400">{{ lesson.words.count }}</span>
      </div>

      <div class="mt-4 space-y-2">
        {% for w in lesson.words.all|slice:":12" %}
          <div class="rounded-2xl border border-white/10 bg-black/20 p-3">
            <div class="arabic-font text-2xl font-black" dir="rtl">{{ w.arabic }}</div>
            <div class="text-xs text-slate-300 mt-1">
              {% if w.translation_uz %}UZ: <span class="text-white font-semibold">{{ w.translation_uz }}</span>{% endif %}
              {% if w.translation_ru %}<span class="text-slate-500"> ‚Ä¢ </span>RU: <span class="text-slate-100 font-semibold">{{ w.translation_ru }}</span>{% endif %}
            </div>
            {% if w.transliteration %}
              <div class="text-xs text-slate-400 mt-1">{{ w.transliteration }}</div>
            {% endif %}
          </div>
        {% empty %}
          <div class="text-slate-400 text-sm">Bu darsga so‚Äòz qo‚Äòshilmagan.</div>
        {% endfor %}
      </div>

      {% if lesson.words.count > 12 %}
        <div class="mt-3 text-xs text-slate-400">Yana so‚Äòzlar lug‚Äòatda.</div>
      {% endif %}
    </section>

    <section class="rounded-3xl border border-white/10 bg-white/5 p-6">
      <div class="flex items-center justify-between">
        <h2 class="text-lg font-bold">üß† Exercises</h2>
        <span class="text-xs text-slate-400">{{ lesson.exercises.count }}</span>
      </div>

      <div class="mt-4 space-y-2">
        {% for e in lesson.exercises.all %}
          <div class="rounded-2xl border border-white/10 bg-black/20 p-4">
            <div class="font-semibold">{{ e.title }}</div>
            <div class="mt-1 text-xs text-slate-400">{{ e.get_type_display }}</div>
            {% if e.instruction %}
              <div class="mt-2 text-sm text-slate-200">{{ e.instruction }}</div>
            {% endif %}
            <div class="mt-3">
              <button class="rounded-2xl bg-white text-slate-950 px-4 py-2 text-sm font-semibold hover:bg-slate-200">
                <a href="{% url 'arab:exercise_run' e.id %}"
                    class="inline-flex rounded-2xl bg-white text-slate-950 px-4 py-2 text-sm font-semibold hover:bg-slate-200">
                    Start
                </a>
              </button>
              <span class="ml-2 text-xs text-slate-400">(keyin backend ulaymiz)</span>
            </div>
          </div>
        {% empty %}
          <div class="text-slate-400 text-sm">Exercise yo‚Äòq.</div>
        {% endfor %}
      </div>
    </section>

  </div>
</div>

{% endblock %}
