{% extends "base.html" %}
{% block title %}Tavsif Quruvchi | AlifPro{% endblock %}
{% block content %}

<div class="max-w-4xl mx-auto py-12 px-4">
    <!-- Header -->
    <div class="mb-10 text-center">
        <div
            class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-amber-500/10 border border-amber-500/20 text-[10px] font-black uppercase tracking-widest text-amber-400 mb-4">
            INTERAKTIV MASHQ
        </div>
        <h1 class="text-4xl font-black text-white mb-3">Tavsif <span class="text-amber-400">Quruvchi</span></h1>
        <p class="text-slate-400">Ot va sifatni tanlang, to'g'ri iborani yozing</p>
    </div>

    <!-- Builder Form -->
    <form method="post" class="space-y-8" id="tavsifForm">
        {% csrf_token %}

        <div class="grid md:grid-cols-2 gap-6">
            <!-- Noun Selection -->
            <div class="p-6 rounded-2xl bg-slate-900/60 border border-white/10">
                <label class="block text-emerald-400 font-bold mb-4">
                    <i class="fas fa-cube mr-2"></i>Ot tanlang
                </label>
                <select name="noun_id" id="nounSelect" required
                    class="w-full px-4 py-3 rounded-xl bg-slate-800 border border-white/10 text-white text-lg">
                    <option value="">-- Ot tanlang --</option>
                    {% for noun in nouns %}
                    <option value="{{ noun.id }}" data-arabic="{{ noun.arabic }}" data-gender="{{ noun.gender }}"
                        data-number="{{ noun.number }}">
                        {{ noun.arabic }} - {{ noun.translation_uz }} ({{ noun.get_gender_display }})
                    </option>
                    {% endfor %}
                </select>
                <div id="nounPreview" class="mt-4 text-center text-4xl font-arabic text-emerald-400 hidden"></div>
            </div>

            <!-- Adjective Selection -->
            <div class="p-6 rounded-2xl bg-slate-900/60 border border-white/10">
                <label class="block text-sky-400 font-bold mb-4">
                    <i class="fas fa-star mr-2"></i>Sifat tanlang
                </label>
                <select name="adjective_id" id="adjSelect" required
                    class="w-full px-4 py-3 rounded-xl bg-slate-800 border border-white/10 text-white text-lg">
                    <option value="">-- Sifat tanlang --</option>
                    {% for adj in adjectives %}
                    <option value="{{ adj.id }}" data-masc="{{ adj.arabic_masc }}" data-fem="{{ adj.arabic_fem }}">
                        {{ adj.arabic_masc }} / {{ adj.arabic_fem }} - {{ adj.translation_uz }}
                    </option>
                    {% endfor %}
                </select>
                <div id="adjPreview" class="mt-4 text-center text-4xl font-arabic text-sky-400 hidden"></div>
            </div>
        </div>

        <!-- Definite Toggle -->
        <div class="flex items-center justify-center gap-4 p-4 rounded-2xl bg-slate-900/60 border border-white/10">
            <span class="text-slate-400">Nakirah (noaniq)</span>
            <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" name="definite" id="definiteToggle" class="sr-only peer">
                <div
                    class="w-14 h-7 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-amber-500">
                </div>
            </label>
            <span class="text-amber-400">Ma'rifah (aniq)</span>
        </div>

        <!-- User Input -->
        <div class="p-6 rounded-2xl bg-slate-900/60 border border-white/10">
            <label class="block text-white font-bold mb-4">
                <i class="fas fa-pen mr-2"></i>Tavsif iborasini yozing
            </label>
            <input type="text" name="user_phrase" id="userPhrase" dir="rtl" required
                placeholder="Ot + sifat iborasini yozing..."
                class="w-full px-6 py-4 rounded-xl bg-slate-800 border border-white/10 text-white text-2xl font-arabic text-center focus:outline-none focus:border-amber-500/50">
        </div>

        <button type="submit"
            class="w-full py-4 rounded-2xl bg-amber-500 text-slate-900 font-bold text-lg hover:bg-amber-400 transition-all">
            <i class="fas fa-check mr-2"></i>Tekshirish
        </button>
    </form>

    <!-- Result -->
    {% if result %}
    <div
        class="mt-10 p-8 rounded-[2rem] {% if result.is_correct %}bg-emerald-500/20 border-emerald-500/50{% else %}bg-rose-500/20 border-rose-500/50{% endif %} border">
        <div class="text-center">
            {% if result.is_correct %}
            <div class="text-6xl mb-4">üéâ</div>
            <h2 class="text-3xl font-bold text-emerald-400 mb-2">To'g'ri!</h2>
            {% else %}
            <div class="text-6xl mb-4">‚ùå</div>
            <h2 class="text-3xl font-bold text-rose-400 mb-2">Noto'g'ri</h2>
            {% endif %}

            <div class="space-y-4 mt-6">
                <div>
                    <div class="text-sm text-slate-400 mb-1">Sizning javobingiz:</div>
                    <div
                        class="text-2xl font-arabic {% if result.is_correct %}text-emerald-400{% else %}text-rose-400{% endif %}">
                        {{ result.user_phrase }}</div>
                </div>

                {% if not result.is_correct %}
                <div>
                    <div class="text-sm text-slate-400 mb-1">To'g'ri javob:</div>
                    <div class="text-2xl font-arabic text-emerald-400">{{ result.correct_phrase }}</div>
                </div>
                {% endif %}

                <div class="pt-4 border-t border-white/10 text-sm text-slate-400">
                    <span class="text-emerald-400">{{ result.noun.arabic }}</span>
                    ({{ result.noun.get_gender_display }}, {{ result.noun.get_number_display }}) +
                    <span class="text-sky-400">{{ result.adjective.arabic_masc }}</span>
                    {% if result.definite %} = Ma'rifah{% else %} = Nakirah{% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Back Link -->
    <div class="mt-8 text-center">
        <a href="{% url 'arab:tavsif_index' %}" class="text-slate-400 hover:text-amber-400 transition-colors">
            <i class="fas fa-arrow-left mr-2"></i>Lug'atga qaytish
        </a>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const nounSelect = document.getElementById('nounSelect');
        const adjSelect = document.getElementById('adjSelect');
        const nounPreview = document.getElementById('nounPreview');
        const adjPreview = document.getElementById('adjPreview');

        nounSelect.addEventListener('change', function () {
            const option = this.selectedOptions[0];
            if (option.value) {
                nounPreview.textContent = option.dataset.arabic;
                nounPreview.classList.remove('hidden');
            } else {
                nounPreview.classList.add('hidden');
            }
        });

        adjSelect.addEventListener('change', function () {
            const option = this.selectedOptions[0];
            if (option.value) {
                adjPreview.textContent = option.dataset.masc;
                adjPreview.classList.remove('hidden');
            } else {
                adjPreview.classList.add('hidden');
            }
        });
    });
</script>

{% endblock %}