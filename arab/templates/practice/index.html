{% extends "base.html" %}
{% load sanitize %}
{% block title %}Mashq Hubi - Arab tili va Tajvid{% endblock %}
{% block content %}

<!-- GAMIFICATION DASHBOARD -->
<section class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-10">
  <!-- User Stats Card -->
  <div
    class="lg:col-span-2 relative overflow-hidden rounded-[3rem] border border-white/10 bg-slate-900/40 p-10 shadow-2xl">
    <div class="pointer-events-none absolute -top-32 -left-32 h-80 w-80 rounded-full bg-sky-500/10 blur-[100px]"></div>

    <div class="relative z-10 flex flex-col md:flex-row items-center gap-10">
      <!-- Level Avatar -->
      <div class="relative">
        <div class="h-32 w-32 rounded-full bg-gradient-to-tr from-sky-500 to-emerald-500 p-1">
          <div
            class="h-full w-full rounded-full bg-slate-950 flex items-center justify-center border-4 border-slate-900 shadow-2xl">
            <span class="text-4xl font-black text-white">{{ game.level|default:1 }}</span>
          </div>
        </div>
        <div
          class="absolute -bottom-2 left-1/2 -translate-x-1/2 px-4 py-1 rounded-full bg-white text-slate-950 text-[10px] font-black tracking-widest uppercase">
          DARAJA
        </div>
      </div>

      <!-- XP & Progress -->
      <div class="flex-1 space-y-6 text-center md:text-left" x-data="liveStats()" x-init="init()">
        <div class="space-y-1">
          <h1 class="text-3xl font-black text-white">Xush kelibsiz!</h1>
          <p class="text-slate-400 text-sm">O'quv jarayoningiz juda yaxshi ketyapti.</p>
        </div>

        <div class="space-y-2">
          <div class="flex justify-between text-xs font-bold uppercase tracking-widest">
            <span class="text-sky-400">Tajriba (XP)</span>
            <span class="text-slate-500"><span x-text="levelXp"></span> / <span x-text="levelMax"></span> XP</span>
          </div>
          <div class="h-3 w-full bg-white/5 rounded-full overflow-hidden border border-white/5">
            <div class="h-full bg-gradient-to-r from-sky-500 to-emerald-500 transition-all duration-1000"
              :style="'width: ' + xp_pct + '%'"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Weekly Activity Card -->
  <div class="relative overflow-hidden rounded-[3rem] border border-white/10 bg-slate-950/60 p-10 shadow-2xl">
    <div class="relative z-10 flex flex-col justify-between h-full gap-6">
      <div class="text-center">
        <div class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-4 italic">So'nggi 7 kun</div>
        <div class="flex items-center justify-between gap-2">
          {% for s in week_stats %}
          <div class="flex flex-col items-center gap-2">
            <div class="h-10 w-10 rounded-xl grid place-items-center transition-all duration-500 border
                        {% if s.goal_met %}
                            bg-emerald-500/20 border-emerald-500 text-emerald-400 shadow-lg shadow-emerald-500/20
                        {% elif s.has_data %}
                            bg-red-500/20 border-red-500 text-red-400 shadow-lg shadow-red-500/20
                        {% else %}
                            bg-white/5 border-white/5 text-slate-600
                        {% endif %}
                        {% if s.is_today %}ring-2 ring-white/20 scale-110{% endif %}">
              <span class="text-[10px] font-black uppercase">{{ s.day_name|slice:":1" }}</span>
            </div>
            <div class="text-[8px] font-bold {% if s.is_today %}text-white{% else %}text-slate-500{% endif %}">
              {{ s.day_name }}
            </div>
          </div>
          {% endfor %}
        </div>
      </div>

      <div class="text-center pt-4 border-t border-white/5">
        <div class="text-2xl font-black text-white">{{ current_streak }}</div>
        <div class="text-[9px] font-black text-slate-500 uppercase tracking-[0.2em]">KUNLIK STREAK ğŸ”¥</div>
      </div>
    </div>
  </div>
</section>

<!-- PRACTICE MODULES GRID -->
<div class="space-y-12">

  <!-- LEVEL A0 -->
  <div>
    <div class="flex items-center gap-3 mb-6">
      <div
        class="px-3 py-1 rounded bg-emerald-500/20 border border-emerald-500/30 text-emerald-400 text-xs font-black tracking-widest uppercase">
        A0</div>
      <h2 class="text-xl font-black text-slate-200">Boshlang'ich Bosqich</h2>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <!-- Alphabet Explorer -->
      <a href="/alphabet/"
        class="group relative bg-slate-900/40 border border-white/10 rounded-[2.5rem] p-8 transition-all duration-500 hover:bg-slate-800/50 hover:border-orange-500/30 hover:-translate-y-2 shadow-xl flex flex-col">
        <div class="text-3xl mb-6 group-hover:scale-110 transition-transform">ğŸ”¡</div>
        <h3 class="text-xl font-black text-white mb-2">Alifbo Sirlari</h3>
        <p class="text-xs text-slate-400 leading-relaxed mb-6">28 ta harfning maxraji va yozilish shakllari bilan
          batafsil
          tanishish.</p>
        <div class="mt-auto pt-6 border-t border-white/5 flex items-center justify-between">
          <span class="text-[10px] font-bold text-orange-400 uppercase tracking-widest">Noldan</span>
          <span class="text-white group-hover:translate-x-2 transition-transform">â†’</span>
        </div>
      </a>

      <!-- Dictionary Explorer -->
      <a href="/dictionary/"
        class="group relative bg-slate-900/40 border border-white/10 rounded-[2.5rem] p-8 transition-all duration-500 hover:bg-slate-800/50 hover:border-purple-500/30 hover:-translate-y-2 shadow-xl flex flex-col">
        <div class="text-3xl mb-6 group-hover:scale-110 transition-transform">ğŸ“š</div>
        <h3 class="text-xl font-black text-white mb-2">Lug'at Boyligi</h3>
        <p class="text-xs text-slate-400 leading-relaxed mb-6">So'zlar ma'nosini o'rganing va ularni o'zingizning review
          kartangizga qo'shing.</p>
        <div class="mt-auto pt-6 border-t border-white/5 flex items-center justify-between">
          <span class="text-[10px] font-bold text-purple-400 uppercase tracking-widest">1000+ so'z</span>
          <span class="text-white group-hover:translate-x-2 transition-transform">â†’</span>
        </div>
      </a>
    </div>
  </div>

  <!-- LEVEL A1-A2 -->
  <div>
    <div class="flex items-center gap-3 mb-6">
      <div
        class="px-3 py-1 rounded bg-sky-500/20 border border-sky-500/30 text-sky-400 text-xs font-black tracking-widest uppercase">
        A1-A2</div>
      <h2 class="text-xl font-black text-slate-200">Elementar Bosqich</h2>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <!-- Match Game -->
      <a href="{% url 'arab:practice_match_game' %}"
        class="group relative bg-slate-900/40 border border-white/10 rounded-[2.5rem] p-8 transition-all duration-500 hover:bg-slate-800/50 hover:border-emerald-500/30 hover:-translate-y-2 shadow-xl flex flex-col">
        <div class="text-3xl mb-6 group-hover:scale-110 transition-transform">ğŸ§©</div>
        <h3 class="text-xl font-black text-white mb-2">Match Game</h3>
        <p class="text-xs text-slate-400 leading-relaxed mb-6">So'zlarni moslashtirib xotirani mustahkamlang.</p>
        <div class="mt-auto pt-6 border-t border-white/5 flex items-center justify-between">
          <span class="text-[10px] font-bold text-emerald-400 uppercase tracking-widest">+10 XP</span>
          <span class="text-white group-hover:translate-x-2 transition-transform">â†’</span>
        </div>
      </a>

      <!-- Weak Words -->
      <a href="{% url 'arab:practice_weak_words' %}"
        class="group relative bg-slate-900/40 border border-white/10 rounded-[2.5rem] p-8 transition-all duration-500 hover:bg-slate-800/50 hover:border-red-500/30 hover:-translate-y-2 shadow-xl flex flex-col">
        <div class="text-3xl mb-6 group-hover:scale-110 transition-transform">ğŸ©¸</div>
        <h3 class="text-xl font-black text-white mb-2">Kuchsiz So'zlar</h3>
        <p class="text-xs text-slate-400 leading-relaxed mb-6">Siz eng ko'p xato qiladigan va mustahkamlash kerak
          bo'lgan
          so'zlar to'plami.</p>
        <div class="mt-auto pt-6 border-t border-white/5 flex items-center justify-between">
          <span class="text-[10px] font-bold text-red-400 uppercase tracking-widest">Diqqat Qiling</span>
          <span class="text-white group-hover:translate-x-2 transition-transform">â†’</span>
        </div>
      </a>

      <!-- Tavsif - NEW -->
      <a href="{% url 'arab:tavsif_index' %}"
        class="group relative bg-slate-900/40 border border-white/10 rounded-[2.5rem] p-8 transition-all duration-500 hover:bg-slate-800/50 hover:border-amber-500/30 hover:-translate-y-2 shadow-xl flex flex-col">
        <div class="text-3xl mb-6 group-hover:scale-110 transition-transform">ğŸ“–</div>
        <h3 class="text-xl font-black text-white mb-2">Tavsif Lug'ati</h3>
        <p class="text-xs text-slate-400 leading-relaxed mb-6">Ot + sifat birikmalari. Jins va son muvofiqligini
          o'rganing.</p>
        <div class="mt-auto pt-6 border-t border-white/5 flex items-center justify-between">
          <span class="text-[10px] font-bold text-amber-400 uppercase tracking-widest">Avto-tuzatish</span>
          <span class="text-white group-hover:translate-x-2 transition-transform">â†’</span>
        </div>
      </a>

      <!-- Fe'l Mashqi - NEW -->
      <a href="{% url 'arab:verb_practice_index' %}"
        class="group relative bg-slate-900/40 border border-white/10 rounded-[2.5rem] p-8 transition-all duration-500 hover:bg-slate-800/50 hover:border-cyan-500/30 hover:-translate-y-2 shadow-xl flex flex-col">
        <div class="text-3xl mb-6 group-hover:scale-110 transition-transform">ğŸƒ</div>
        <h3 class="text-xl font-black text-white mb-2">Fe'l Tuslanishi</h3>
        <p class="text-xs text-slate-400 leading-relaxed mb-6">Moziy, Mudori, Amr - barcha tuslanishlarni mashq qiling.
        </p>
        <div class="mt-auto pt-6 border-t border-white/5 flex items-center justify-between">
          <span class="text-[10px] font-bold text-cyan-400 uppercase tracking-widest">Jadvallar</span>
          <span class="text-white group-hover:translate-x-2 transition-transform">â†’</span>
        </div>
      </a>

      <!-- Gap Tuzish - NEW -->
      <a href="{% url 'arab:sentence_builder_index' %}"
        class="group relative bg-slate-900/40 border border-white/10 rounded-[2.5rem] p-8 transition-all duration-500 hover:bg-slate-800/50 hover:border-orange-500/30 hover:-translate-y-2 shadow-xl flex flex-col">
        <div class="text-3xl mb-6 group-hover:scale-110 transition-transform">ğŸ§±</div>
        <h3 class="text-xl font-black text-white mb-2">Gap Tuzish</h3>
        <p class="text-xs text-slate-400 leading-relaxed mb-6">So'zlarni tartibga qo'ying va to'g'ri gap tuzing.</p>
        <div class="mt-auto pt-6 border-t border-white/5 flex items-center justify-between">
          <span class="text-[10px] font-bold text-orange-400 uppercase tracking-widest">Interaktiv</span>
          <span class="text-white group-hover:translate-x-2 transition-transform">â†’</span>
        </div>
      </a>

      <!-- Gapirish - NEW -->
      <a href="{% url 'arab:speaking_index' %}"
        class="group relative bg-slate-900/40 border border-white/10 rounded-[2.5rem] p-8 transition-all duration-500 hover:bg-slate-800/50 hover:border-pink-500/30 hover:-translate-y-2 shadow-xl flex flex-col">
        <div class="text-3xl mb-6 group-hover:scale-110 transition-transform">ğŸ¤</div>
        <h3 class="text-xl font-black text-white mb-2">Gapirish Darslari</h3>
        <p class="text-xs text-slate-400 leading-relaxed mb-6">100 ta dars - suhbat va dialoglar orqali gapirish.</p>
        <div class="mt-auto pt-6 border-t border-white/5 flex items-center justify-between">
          <span class="text-[10px] font-bold text-pink-400 uppercase tracking-widest">100 Dars</span>
          <span class="text-white group-hover:translate-x-2 transition-transform">â†’</span>
        </div>
      </a>
    </div>
  </div>

  <!-- LEVEL B1+ -->
  <div>
    <div class="flex items-center gap-3 mb-6">
      <div
        class="px-3 py-1 rounded bg-fuchsia-500/20 border border-fuchsia-500/30 text-fuchsia-400 text-xs font-black tracking-widest uppercase">
        B1+</div>
      <h2 class="text-xl font-black text-slate-200">Mustaqil O'rganuvchi</h2>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <!-- Spaced Review -->
      <a href="/review/"
        class="group relative bg-slate-900/40 border border-white/10 rounded-[2.5rem] p-8 transition-all duration-500 hover:bg-slate-800/50 hover:border-emerald-500/30 hover:-translate-y-2 shadow-xl flex flex-col">
        <div class="text-3xl mb-6 group-hover:scale-110 transition-transform">ğŸ§ </div>
        <h3 class="text-xl font-black text-white mb-2">Smart Takrorlash</h3>
        <p class="text-xs text-slate-400 leading-relaxed mb-6">Spaced repetition algoritmi asosida faqat kerakli
          so'zlarni
          takrorlang.</p>
        <div class="mt-auto pt-6 border-t border-white/5 flex items-center justify-between">
          <span class="text-[10px] font-bold text-emerald-400 uppercase tracking-widest">Tavsiya etiladi</span>
          <span class="text-white group-hover:translate-x-2 transition-transform">â†’</span>
        </div>
      </a>
      <!-- Xattotlik -->
      <a href="{% url 'arab:alphabet' %}"
        class="group relative bg-slate-900/40 border border-white/10 rounded-[2.5rem] p-8 transition-all duration-500 hover:bg-slate-800/50 hover:border-sky-500/30 hover:-translate-y-2 shadow-xl flex flex-col">
        <div class="text-3xl mb-6 group-hover:scale-110 transition-transform">âœï¸</div>
        <h3 class="text-xl font-black text-white mb-2">Xattotlik & Doska</h3>
        <p class="text-xs text-slate-400 leading-relaxed mb-6">Harflarni yozishni mashq qiling va xattotlik sirlarini
          o'rganing.</p>
        <div class="mt-auto pt-6 border-t border-white/5 flex items-center justify-between">
          <span class="text-[10px] font-bold text-sky-400 uppercase tracking-widest">Interaktiv</span>
          <span class="text-white group-hover:translate-x-2 transition-transform">â†’</span>
        </div>
      </a>

      <!-- Sarf - NEW -->
      <a href="{% url 'arab:sarf_index' %}"
        class="group relative bg-slate-900/40 border border-white/10 rounded-[2.5rem] p-8 transition-all duration-500 hover:bg-slate-800/50 hover:border-violet-500/30 hover:-translate-y-2 shadow-xl flex flex-col">
        <div class="text-3xl mb-6 group-hover:scale-110 transition-transform">ğŸŒ±</div>
        <h3 class="text-xl font-black text-white mb-2">Sarf - Ildiz Ilmi</h3>
        <p class="text-xs text-slate-400 leading-relaxed mb-6">Ildizdan so'z hosil qilish - morfologiya asoslari.</p>
        <div class="mt-auto pt-6 border-t border-white/5 flex items-center justify-between">
          <span class="text-[10px] font-bold text-violet-400 uppercase tracking-widest">Hosilalar</span>
          <span class="text-white group-hover:translate-x-2 transition-transform">â†’</span>
        </div>
      </a>

      <!-- Nahv - NEW -->
      <a href="{% url 'arab:nahv_index' %}"
        class="group relative bg-slate-900/40 border border-white/10 rounded-[2.5rem] p-8 transition-all duration-500 hover:bg-slate-800/50 hover:border-rose-500/30 hover:-translate-y-2 shadow-xl flex flex-col">
        <div class="text-3xl mb-6 group-hover:scale-110 transition-transform">ğŸ“</div>
        <h3 class="text-xl font-black text-white mb-2">Nahv - Gap Tahlili</h3>
        <p class="text-xs text-slate-400 leading-relaxed mb-6">I'rob tahlili - gap tuzilishi va grammatik rollar.</p>
        <div class="mt-auto pt-6 border-t border-white/5 flex items-center justify-between">
          <span class="text-[10px] font-bold text-rose-400 uppercase tracking-widest">Grammatika</span>
          <span class="text-white group-hover:translate-x-2 transition-transform">â†’</span>
        </div>
      </a>
    </div>
  </div>
</div>

<script>
  function liveStats() {
    return {
      xp: {{ game.xp_total |default: 0 }
  },
  level: { { game.level |default: 1 } },
  levelXp: 0,
    levelMax: 100,
      xp_pct: 0,
        init() {
    this.updateData();
  },
      async updateData() {
    try {
      const response = await fetch('/api/stats/live/');
      const data = await response.json();
      this.xp = data.xp;
      this.level = data.level;
      this.levelXp = data.level_xp_current;
      this.levelMax = data.level_xp_max;
      this.xp_pct = data.xp_pct;
    } catch (e) {
      console.error("Live stats fetch error:", e);
    }
  }
    }
  }
</script>

{% endblock %}