{% extends "base.html" %}
{% load sanitize %}

{% block title %}Kuchsiz So'zlar - AlifPro Academy{% endblock %}

{% block content %}
<div x-data="weakWordsSession()" class="max-w-2xl mx-auto py-12 px-4 min-h-[80vh] flex flex-col justify-center" x-cloak>

    <!-- Top Progress Bar -->
    <div class="mb-10 space-y-4" x-show="currentIndex < totalItems">
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="p-2 rounded-xl bg-red-500/10 text-red-500 shadow-lg shadow-red-500/5">
                    <i class="fas fa-tint"></i>
                </div>
                <div>
                    <h1 class="text-xl font-black text-white">Kuchsiz So'zlar</h1>
                    <p class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Zaif nuqtalarni
                        mustahkamlash</p>
                </div>
            </div>
            <div class="text-right">
                <div class="text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] mb-1">Savol</div>
                <div class="text-lg font-black text-white">
                    <span x-text="currentIndex + 1"></span>
                    <span class="text-slate-600 mx-1">/</span>
                    <span x-text="totalItems"></span>
                </div>
            </div>
        </div>

        <div class="relative h-2 w-full bg-white/5 rounded-full overflow-hidden border border-white/5">
            <div class="absolute inset-0 bg-gradient-to-r from-red-500/10 to-orange-500/10"></div>
            <div class="h-full bg-gradient-to-r from-red-500 to-orange-500 shadow-[0_0_15px_rgba(239,68,68,0.5)] transition-all duration-700 ease-out"
                :style="'width: ' + progress + '%'"></div>
        </div>
    </div>

    <!-- Quiz Deck -->
    <div class="relative h-[500px]">
        {% for item in items %}
        <div x-show="currentIndex === {{ forloop.index0 }}" x-transition:enter="transition ease-out duration-500"
            x-transition:enter-start="opacity-0 translate-y-8 scale-95"
            x-transition:enter-end="opacity-100 translate-y-0 scale-100" class="absolute inset-0">

            <div
                class="h-full w-full rounded-[3rem] border border-white/10 bg-slate-900/60 backdrop-blur-xl p-10 flex flex-col items-center justify-center text-center space-y-10 shadow-2xl relative overflow-hidden group">
                <!-- Background Decorative Gradients -->
                <div
                    class="absolute -top-24 -right-24 h-64 w-64 rounded-full bg-red-500/5 blur-3xl group-hover:bg-red-500/10 transition-colors duration-700">
                </div>
                <div
                    class="absolute -bottom-24 -left-24 h-64 w-64 rounded-full bg-orange-500/5 blur-3xl group-hover:bg-orange-500/10 transition-colors duration-700">
                </div>

                <div class="relative z-10 space-y-8 w-full">
                    <div
                        class="inline-flex px-4 py-1.5 rounded-full bg-white/5 border border-white/10 text-[9px] font-black tracking-widest text-slate-500 uppercase">
                        Bu qanday so'z?
                    </div>

                    <div class="arabic-font text-6xl md:text-8xl font-black text-white drop-shadow-2xl select-none leading-relaxed"
                        dir="rtl">
                        {{ item.word.arabic }}
                    </div>
                </div>

                <!-- Multiple Choice Grid -->
                <div class="relative z-10 grid grid-cols-1 md:grid-cols-2 gap-4 w-full"
                    x-show="selectedAnswer === null">
                    {% for opt in item.options %}
                    <button @click="handleAnswer('{{ opt|escapejs }}', '{{ item.word.translation_uz|escapejs }}')"
                        class="p-4 rounded-3xl bg-white/5 border border-white/10 text-slate-300 font-bold hover:bg-white/10 hover:border-white/20 hover:text-white hover:scale-[1.02] active:scale-[0.98] transition-all duration-300 text-sm md:text-base leading-tight">
                        {{ opt }}
                    </button>
                    {% endfor %}
                </div>

                <!-- Results & Feedback -->
                <div class="relative z-10 w-full space-y-8" x-show="selectedAnswer !== null">
                    <div class="flex flex-col items-center gap-4">
                        <template x-if="isCorrect">
                            <div class="flex flex-col items-center gap-2">
                                <div
                                    class="h-20 w-20 rounded-full bg-emerald-500/20 text-emerald-500 flex items-center justify-center text-3xl shadow-lg shadow-emerald-500/10 animate-bounce">
                                    <i class="fas fa-check"></i>
                                </div>
                                <h3 class="text-2xl font-black text-emerald-400">Barakalla!</h3>
                            </div>
                        </template>
                        <template x-if="!isCorrect">
                            <div class="flex flex-col items-center gap-2">
                                <div
                                    class="h-20 w-20 rounded-full bg-red-500/20 text-red-500 flex items-center justify-center text-3xl shadow-lg shadow-red-500/10">
                                    <i class="fas fa-times"></i>
                                </div>
                                <h3 class="text-2xl font-black text-red-400">Xato qildingiz</h3>
                            </div>
                        </template>
                    </div>

                    <div class="space-y-1">
                        <div class="text-[10px] font-black text-slate-500 uppercase tracking-widest">To'g'ri javob</div>
                        <div class="text-3xl font-black text-white leading-tight">{{ item.word.translation_uz }}</div>
                        <div class="text-slate-400 italic text-sm">{{ item.word.transliteration }}</div>
                    </div>

                    <button @click="nextQuestion()"
                        class="w-full max-w-xs py-4 rounded-2xl bg-white text-slate-950 font-black text-xs tracking-widest hover:bg-slate-200 transition-colors shadow-xl">
                        DAVOM ETISH
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}

        <!-- Completed State -->
        <div x-show="currentIndex >= totalItems" x-transition:enter="transition ease-out duration-700"
            class="h-full w-full rounded-[3.5rem] border border-white/10 bg-slate-900 p-12 flex flex-col items-center justify-center text-center space-y-10 shadow-2xl relative overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-br from-emerald-500/5 to-sky-500/5 opacity-50"></div>

            <div class="relative z-10 space-y-6">
                <div class="text-7xl">üèÜ</div>
                <div class="space-y-2">
                    <h2 class="text-4xl font-black text-white uppercase tracking-tight">Ajoyib!</h2>
                    <p class="text-slate-400 font-medium max-w-xs mx-auto text-sm leading-relaxed">
                        Siz barcha zaif so'zlarni takrorlab chiqdingiz. Bilimingiz mustahkamlanmoqda!
                    </p>
                </div>

                <div class="flex flex-col items-center gap-2">
                    <div class="text-[10px] font-black text-slate-500 uppercase tracking-[0.2em]">Natija</div>
                    <div
                        class="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-sky-400">
                        <span x-text="score"></span> <span class="text-slate-700 mx-2">/</span> <span
                            x-text="totalItems"></span>
                    </div>
                </div>

                <div class="pt-8 flex flex-col sm:flex-row gap-4 w-full justify-center">
                    <a href="/practice/"
                        class="px-8 py-4 rounded-2xl bg-white text-slate-950 font-black text-xs tracking-widest hover:scale-105 transition-transform shadow-xl">
                        MASHQ HUBI
                    </a>
                    <button @click="window.location.reload()"
                        class="px-8 py-4 rounded-2xl bg-white/5 border border-white/10 text-white font-black text-xs tracking-widest hover:bg-white/10 transition-all">
                        QAYTA SINASH
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    [x-cloak] {
        display: none !important;
    }

    .arabic-font {
        font-family: 'Noto Naskh Arabic', serif;
    }
</style>

<script>
    function weakWordsSession() {
        return {
            currentIndex: 0,
            totalItems: {{ items | length }
    },
    selectedAnswer: null,
        isCorrect: false,
            score: 0,
                get progress() {
        return this.totalItems > 0 ? (this.currentIndex / this.totalItems) * 100 : 0;
    },
    handleAnswer(opt, correct) {
        this.selectedAnswer = opt;
        this.isCorrect = (opt === correct);
        if (this.isCorrect) {
            this.score++;
        }
    },
    nextQuestion() {
        this.selectedAnswer = null;
        this.currentIndex++;
    }
    }
}
</script>
{% endblock %}