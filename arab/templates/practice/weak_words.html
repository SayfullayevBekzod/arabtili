{% extends "base.html" %}
{% block title %}Kuchsiz So'zlar - Quiz{% endblock %}
{% block content %}

<div x-data="weakWordsSession()" class="max-w-4xl mx-auto py-10 px-4">
    <!-- Header with Progress -->
    <div class="mb-8 space-y-4">
        <div class="flex items-center justify-between">
            <h1 class="text-2xl font-bold text-white flex items-center gap-2">
                <span class="text-red-500">ðŸ©¸</span> Kuchsiz So'zlar
            </h1>
            <div class="text-sm text-slate-400">
                <span class="text-white font-bold" x-text="currentIndex + 1"></span> / <span x-text="totalItems"></span>
            </div>
        </div>

        <div class="h-2 w-full bg-slate-800 rounded-full overflow-hidden">
            <div class="h-full bg-red-500 transition-all duration-500" :style="'width: ' + progress + '%'"></div>
        </div>
    </div>

    <!-- Quiz Container -->
    <div class="relative min-h-[400px]">
        {% for item in items %}
        <div x-show="currentIndex === {{ forloop.index0 }}" x-transition class="absolute inset-0">
            <div class="bg-slate-900/60 border border-white/10 rounded-2xl p-8 text-center space-y-8">
                <!-- Arabic Word -->
                <div>
                    <div class="text-xs text-slate-500 mb-2">BU QAYSI SO'Z?</div>
                    <div class="text-5xl font-bold text-white" dir="rtl"
                        style="font-family: 'Noto Naskh Arabic', serif;">{{ item.word.arabic }}</div>
                </div>

                <!-- Options -->
                <div class="grid gap-3 max-w-md mx-auto">
                    {% for opt in item.options %}
                    <button @click="handleAnswer('{{ opt }}', '{{ item.word.translation_uz }}')"
                        :class="selectedAnswer === '{{ opt }}' ? (isCorrect ? 'bg-emerald-500 text-white' : 'bg-red-500 text-white') : 'bg-slate-800 hover:bg-slate-700'"
                        :disabled="selectedAnswer !== null"
                        class="w-full p-4 rounded-xl border border-white/10 font-medium transition">
                        {{ opt }}
                    </button>
                    {% endfor %}
                </div>

                <!-- Feedback -->
                <div x-show="selectedAnswer !== null" class="space-y-4">
                    <div :class="isCorrect ? 'text-emerald-400' : 'text-red-400'" class="font-bold">
                        <span x-text="isCorrect ? 'To\'g\'ri!' : 'Xato!'"></span>
                    </div>
                    <div x-show="!isCorrect" class="text-slate-400 text-sm">
                        To'g'ri javob: <span class="text-white">{{ item.word.translation_uz }}</span>
                    </div>
                    <button @click="nextQuestion()"
                        class="px-6 py-2 bg-white text-slate-900 rounded-lg font-bold hover:bg-slate-200 transition">
                        KEYINGISI â†’
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}

        <!-- Completed -->
        <div x-show="currentIndex >= totalItems"
            class="bg-slate-900/60 border border-white/10 rounded-2xl p-12 text-center space-y-6">
            <div class="text-5xl">ðŸŽ‰</div>
            <h2 class="text-2xl font-bold text-white">Mashq yakunlandi!</h2>
            <p class="text-slate-400">Siz <span class="text-emerald-400 font-bold" x-text="score"></span> ta to'g'ri
                javob berdingiz.</p>
            <div class="flex justify-center gap-3">
                <a href="/practice/" class="px-6 py-3 bg-white text-slate-900 rounded-lg font-bold">Hubga qaytish</a>
            </div>
        </div>
    </div>
</div>

<script>
    function weakWordsSession() {
        return {
            currentIndex: 0,
            totalItems: {{ items | length }
    },
    },
    selectedAnswer: null,
        isCorrect: false,
            score: 0,
                get progress() {
        return this.totalItems > 0 ? (this.currentIndex / this.totalItems) * 100 : 0;
    },
    handleAnswer(opt, correct) {
        this.selectedAnswer = opt;
        this.isCorrect = (opt === correct);
        if (this.isCorrect) this.score++;
    },
    nextQuestion() {
        this.selectedAnswer = null;
        this.currentIndex++;
    }
    }
}
</script>

{% endblock %}