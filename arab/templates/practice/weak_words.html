{% extends "base.html" %}
{% block title %}Weak Words Review - Quiz{% endblock %}
{% block content %}

<div x-data="weakWordsSession()" class="max-w-4xl mx-auto py-10 px-4">
    <!-- Header with Progress -->
    <div class="mb-12 space-y-4 text-center md:text-left">
        <div class="flex flex-col md:flex-row items-center justify-between gap-4">
            <h1 class="text-3xl font-black flex items-center gap-3">
                <span class="text-red-500">ðŸ©¸</span> Kuchsiz So'zlar
            </h1>
            <div class="text-xs font-bold text-slate-500 uppercase tracking-widest">
                Savollar: <span class="text-white" x-text="currentIndex + 1"></span> / <span x-text="totalItems"></span>
            </div>
        </div>

        <div class="h-1.5 w-full bg-white/5 rounded-full overflow-hidden border border-white/5">
            <div class="h-full bg-red-400 transition-all duration-500" :style="'width: ' + progress + '%'"></div>
        </div>
    </div>

    <!-- Quiz Container -->
    <div class="relative min-h-[500px]">
        {% for item in items %}
        <div x-show="currentIndex === {{ forloop.index0 }}"
            x-transition:enter="transition ease-out duration-300 transform"
            x-transition:enter-start="opacity-0 translate-x-12" x-transition:enter-end="opacity-100 translate-x-0"
            class="absolute inset-0">

            <div
                class="bg-slate-900/60 border border-white/10 rounded-[3rem] p-8 md:p-16 shadow-2xl backdrop-blur-xl h-full flex flex-col items-center justify-center text-center space-y-12">

                <!-- Arabic Word -->
                <div class="space-y-4">
                    <div class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">BU QAYSI SO'Z?</div>
                    <div class="arabic-font text-5xl md:text-7xl font-black text-white" dir="rtl">
                        {{ item.word.arabic }}
                    </div>
                </div>

                <!-- Multiple Choice Options -->
                <div class="w-full max-w-md grid grid-cols-1 gap-3">
                    {% for opt in item.options %}
                    <button @click="handleAnswer('{{ opt }}', '{{ item.word.translation_uz }}')"
                        :class="selectedAnswer === '{{ opt }}' ? (isCorrect ? 'bg-emerald-500 text-slate-950 border-emerald-500' : 'bg-red-500 text-white border-red-500') : 'bg-white/5 border-white/10 text-slate-200 hover:bg-white/10'"
                        :disabled="selectedAnswer !== null"
                        class="w-full p-5 rounded-2xl border transition-all font-bold text-sm text-center">
                        {{ opt }}
                    </button>
                    {% endfor %}
                </div>

                <!-- Feedback & Next -->
                <div x-show="selectedAnswer !== null" class="w-full max-w-md animate-in fade-in slide-in-from-bottom-4">
                    <div
                        class="flex items-center justify-between gap-4 p-4 rounded-2xl bg-white/5 border border-white/5">
                        <div class="text-left">
                            <div class="text-[10px] font-black uppercase tracking-widest"
                                :class="isCorrect ? 'text-emerald-400' : 'text-red-400'">
                                <span x-text="isCorrect ? 'To\'g\'ri!' : 'Xato!'"></span>
                            </div>
                            <div class="text-xs text-slate-400" x-show="!isCorrect">
                                To'g'ri javob: <span class="text-white">{{ item.word.translation_uz }}</span>
                            </div>
                        </div>
                        <button @click="nextQuestion()"
                            class="px-6 py-2 rounded-xl bg-white text-slate-950 font-black text-xs hover:bg-slate-200 transition">
                            KEYINGISI â†’
                        </button>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}

        <!-- Completed State -->
        <div x-show="currentIndex >= totalItems" x-transition:enter="transition ease-out duration-500"
            class="bg-slate-900/40 border border-white/10 rounded-[3rem] p-16 text-center space-y-8">
            <div class="text-6xl">ðŸ“Š</div>
            <div class="space-y-2">
                <h2 class="text-3xl font-black text-white">Mashq yakunlandi!</h2>
                <p class="text-slate-400">Siz <span class="text-emerald-400 font-bold" x-text="score"></span> ta to'g'ri
                    javob berdingiz.</p>
            </div>

            <div class="flex flex-col md:flex-row justify-center gap-3">
                <a href="/practice/" class="px-8 py-4 rounded-2xl bg-white text-slate-950 font-black text-sm">HUBGA
                    QAYTISH</a>
                <form action="." method="POST" class="m-0">
                    {% csrf_token %}
                    <button type="submit"
                        class="w-full md:w-auto px-8 py-4 rounded-2xl bg-white/5 border border-white/10 text-white font-bold text-sm hover:bg-white/10 transition">
                        NATIJANI SAQLASH
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    function weakWordsSession() {
        return {
            currentIndex: 0,
            totalItems: {{ items | length }
    }
    },
    selectedAnswer: null,
        isCorrect: false,
            score: 0,
                get progress() {
        return this.totalItems > 0 ? (this.currentIndex / this.totalItems) * 100 : 0;
    },
    handleAnswer(opt, correct) {
        this.selectedAnswer = opt;
        this.isCorrect = (opt === correct);
        if (this.isCorrect) this.score++;
    },
    nextQuestion() {
        this.selectedAnswer = null;
        this.currentIndex++;
    }
    }
}
</script>

<style>
    .font-arabic {
        font-family: 'Noto Naskh Arabic', serif;
    }
</style>

{% endblock %}