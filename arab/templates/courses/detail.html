{% extends "base.html" %}
{% block title %}{{ course.title }}{% endblock %}
{% block content %}

<!-- HERO -->
<section
  class="relative overflow-hidden rounded-[2.5rem] border border-white/10 bg-slate-900/40 backdrop-blur-md p-8 md:p-12 mb-8 shadow-2xl">
  <div class="pointer-events-none absolute -top-40 -left-40 h-96 w-96 rounded-full bg-emerald-500/10 blur-[100px]">
  </div>
  <div class="pointer-events-none absolute -bottom-40 -right-40 h-96 w-96 rounded-full bg-sky-500/10 blur-[100px]">
  </div>

  <div class="relative flex flex-col md:flex-row md:items-start md:justify-between gap-8">
    <div class="max-w-3xl space-y-4">
      <div
        class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/5 border border-white/10 text-[10px] font-black uppercase tracking-widest text-slate-400">
        Kurs ‚Ä¢ 0 ‚Üí PRO
      </div>
      <h1 class="text-4xl md:text-6xl font-black leading-tight tracking-tight text-white">{{ course.title }}</h1>
      <p class="text-slate-400 text-base md:text-lg leading-relaxed font-medium">
        {{ course.description }}
      </p>

      <!-- Chips -->
      <div class="pt-4 flex flex-wrap items-center gap-3 text-[10px] font-black uppercase tracking-widest">
        <span class="rounded-2xl border border-white/10 bg-slate-950/40 px-4 py-2 hover:bg-slate-950 transition">
          Level: <span class="text-emerald-400">{{ course.level }}</span>
        </span>

        <span class="rounded-2xl border border-white/10 bg-slate-950/40 px-4 py-2 hover:bg-slate-950 transition">
          Bo'limlar: <span class="text-sky-400">{{ units|length }}</span>
        </span>

        <span class="rounded-2xl border border-white/10 bg-slate-950/40 px-4 py-2 hover:bg-slate-950 transition">
          Darslar:
          <span class="text-amber-400">
            {% with total=0 %}
            {% for u in units %}{% with total=total|add:u.lessons.count %}{% endwith %}{% endfor %}
            {{ total }}
            {% endwith %}
          </span>
        </span>

        {% if course.is_published %}
        <span class="rounded-2xl border border-emerald-500/30 bg-emerald-500/10 px-4 py-2 text-emerald-400">
          Published
        </span>
        {% else %}
        <span class="rounded-2xl border border-yellow-500/30 bg-yellow-500/10 px-4 py-2 text-yellow-400">
          Draft
        </span>
        {% endif %}
      </div>
    </div>

    <div class="flex items-center gap-3">
      <a href="/courses/"
        class="h-12 flex items-center px-6 rounded-2xl border border-white/10 bg-white/5 text-sm font-black uppercase tracking-widest hover:bg-white/10 transition">
        ‚Üê Kurslar
      </a>
      <a href="/practice/"
        class="h-12 flex items-center px-6 rounded-2xl bg-white text-slate-950 text-sm font-black uppercase tracking-widest hover:scale-105 active:scale-95 transition-all shadow-xl">
        üöÄ Mashq
      </a>
    </div>
  </div>
</section>

<!-- UNITS -->
<div class="mt-10 space-y-6">
  {% for u in units %}
  <section
    class="group relative overflow-hidden rounded-[2.5rem] border border-white/10 bg-slate-900/40 backdrop-blur-md p-8 md:p-10 transition-all duration-500 hover:border-emerald-500/30">

    <div
      class="absolute -top-24 -right-24 h-48 w-48 bg-emerald-500/0 group-hover:bg-emerald-500/5 rounded-full blur-3xl transition-all duration-700">
    </div>

    <div class="relative flex flex-col sm:flex-row sm:items-center sm:justify-between gap-6 mb-12">
      <div class="space-y-1">
        <div class="text-[10px] font-black text-slate-500 uppercase tracking-[0.2em]">{{ u.order }}-Bo'lim</div>
        <h2 class="text-2xl md:text-3xl font-black text-white group-hover:text-emerald-400 transition-colors">{{ u.title }}</h2>
      </div>

      <div class="flex items-center gap-3">
        <span
          class="px-4 py-2 rounded-2xl bg-white/5 border border-white/10 text-[10px] font-black uppercase tracking-widest text-slate-400">
          {{ u.lessons.count }} ta dars
        </span>
        <span class="px-3 py-3 rounded-2xl bg-emerald-500/10 border border-emerald-500/20 text-emerald-400 text-xs">
          <i class="fas fa-layer-group"></i>
        </span>
      </div>
    </div>

    <!-- Lessons Tree -->
    <div class="relative max-w-lg mx-auto py-4">
      <!-- Vertical path Line -->
      <div
        class="absolute left-1/2 top-0 bottom-0 w-1.5 bg-slate-950/60 -ml-0.75 rounded-full shadow-inner overflow-hidden">
        <div class="h-full w-full bg-gradient-to-b from-emerald-500 via-sky-500 to-emerald-500 opacity-20"></div>
      </div>

      <div class="space-y-16">
        {% for l in u.lessons.all %}
        <div class="relative flex flex-col items-center group/lesson">

          <!-- Lesson Node -->
          <a href="{% url 'arab:lesson_detail' l.id %}"
            class="z-10 w-24 h-24 rounded-[2rem] border-4 border-slate-950 bg-slate-900 
                      flex items-center justify-center shadow-2xl transition-all duration-500
                      hover:scale-110 active:scale-95 ring-4 ring-transparent hover:ring-white/10
                      {% if l.user_prog and l.user_prog.is_completed %}border-emerald-500/50 shadow-emerald-500/20{% endif %}">

            <div
              class="absolute inset-0 rounded-[1.8rem] bg-gradient-to-br transition-opacity
                      {% if l.user_prog and l.user_prog.is_completed %}from-emerald-400 to-emerald-600 opacity-100{% else %}from-slate-700 to-slate-800 opacity-50{% endif %}">
            </div>

            <span class="relative text-3xl drop-shadow-lg">{% if l.user_prog and l.user_prog.is_completed %}‚úÖ{% else %}üìö{% endif %}</span> {% if l.user_prog and not l.user_prog.is_completed and l.user_prog.percent > 0 %}
            <div
              class="absolute -bottom-2 -right-2 bg-sky-500 text-[10px] font-black px-2.5 py-1 rounded-xl border-4 border-slate-900 shadow-xl">
              {{ l.user_prog.percent }}%
            </div>
            {% endif %}
          </a>

          <!-- Connecting line glow for completed -->
          {% if l.user_prog and l.user_prog.is_completed %}
          <div class="absolute top-1/2 -z-0 h-24 w-1 bg-emerald-500/30 blur-sm rounded-full pointer-events-none"></div>
          {% endif %}

          <!-- Label -->
          <div class="mt-6 flex flex-col items-center gap-2 group/label">
            <h3
              class="text-white font-black text-sm tracking-tight text-center group-hover/lesson:text-emerald-400 transition-colors">
              {{ l.order }}. {{ l.title }}
              {% if l.videos.all %}
              <i class="fas fa-play-circle ml-1 text-sky-400"></i>
              {% endif %}
            </h3>
            <div class="flex items-center gap-2">
              {% if l.user_prog and l.user_prog.is_completed %}
              <span
                class="px-2 py-0.5 rounded-lg bg-emerald-500/10 text-[9px] font-black text-emerald-400 uppercase tracking-widest border border-emerald-500/20">Bajarildi</span>
              {% else %}
              <span
                class="px-2 py-0.5 rounded-lg bg-white/5 text-[9px] font-black text-slate-500 uppercase tracking-widest border border-white/5">‚è±
                {{ l.estimated_minutes }} min</span>
              {% endif %}
            </div>
          </div>

        </div>
        {% empty %}
        <div class="text-center py-10 bg-white/5 rounded-3xl border border-white/5 text-slate-500 text-sm font-medium">
          Hali darslar qo‚Äòshilmagan.
        </div>
        {% endfor %}
      </div>
    </div>

  </section>
  {% empty %}
  <div class="rounded-[2.5rem] border border-white/10 bg-slate-900/40 p-12 text-center text-slate-500 font-medium">
    Bu kursda hozircha bo'limlar yo‚Äòq.
  </div>
  {% endfor %}
</div>

<!-- Bottom Info -->
<div class="mt-12 group relative rounded-[2.5rem] p-[1px] overflow-hidden transition-all hover:translate-y-[-2px]">
  <div class="absolute inset-0 bg-gradient-to-r from-emerald-500/20 to-sky-500/20"></div>
  <div
    class="relative bg-slate-900/80 backdrop-blur-xl p-8 rounded-[2.4rem] border border-white/5 flex items-start gap-6">
    <div class="h-12 w-12 rounded-2xl bg-white/5 border border-white/10 flex items-center justify-center text-2xl">üí°
    </div>
    <div class="space-y-2">
      <div class="text-lg font-black text-white">O'quv maslahati</div>
      <p class="text-base text-slate-400 leading-relaxed font-medium">
        Har bir bo‚Äòlimni tizimli ravishda: <span class="text-emerald-400">dars</span> ‚Üí <span
          class="text-sky-400">mashq</span> ‚Üí <span class="text-amber-400">takrorlash</span> ketma-ketligida o'rganing.
        Katta natijalarga har kungi kichik qadamlar bilan erishiladi!
      </p>
    </div>
  </div>
</div>

{% endblock %}