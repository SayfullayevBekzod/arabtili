{% extends "base.html" %}
{% block title %}{{ course.title }}{% endblock %}
{% block content %}

<!-- HERO -->
<section class="relative overflow-hidden rounded-3xl border border-white/10 bg-white/5 p-6 md:p-10">
  <div class="pointer-events-none absolute -top-32 -left-32 h-80 w-80 rounded-full bg-emerald-400/15 blur-3xl"></div>
  <div class="pointer-events-none absolute -bottom-32 -right-32 h-80 w-80 rounded-full bg-sky-400/15 blur-3xl"></div>

  <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-5">
    <div class="max-w-3xl">
      <div class="text-xs text-slate-400">Courses â€¢ 0 â†’ PRO</div>
      <h1 class="mt-1 text-3xl md:text-5xl font-black leading-tight">{{ course.title }}</h1>
      <p class="mt-3 text-slate-300 text-sm leading-relaxed">
        {{ course.description }}
      </p>

      <!-- Chips -->
      <div class="mt-5 flex flex-wrap items-center gap-2 text-xs">
        <span class="rounded-full border border-white/10 bg-slate-950/40 px-3 py-1">
          Level: <span class="text-slate-200 font-semibold">{{ course.level }}</span>
        </span>

        <span class="rounded-full border border-white/10 bg-slate-950/40 px-3 py-1">
          Units: <span class="text-slate-200 font-semibold">{{ units|length }}</span>
        </span>

        <span class="rounded-full border border-white/10 bg-slate-950/40 px-3 py-1">
          Total lessons:
          <span class="text-slate-200 font-semibold">
            {% with total=0 %}
            {% for u in units %}{% with total=total|add:u.lessons.count %}{% endwith %}{% endfor %}
            {{ total }}
            {% endwith %}
          </span>
        </span>

        {% if course.is_published %}
        <span class="rounded-full border border-emerald-400/30 bg-emerald-500/15 px-3 py-1 text-emerald-200">
          Published
        </span>
        {% else %}
        <span class="rounded-full border border-yellow-400/30 bg-yellow-500/15 px-3 py-1 text-yellow-200">
          Draft
        </span>
        {% endif %}
      </div>
    </div>

    <div class="flex items-center gap-2">
      <a href="/courses/"
        class="rounded-2xl border border-white/10 bg-white/5 px-4 py-2 text-sm hover:bg-white/10 transition">
        â† Kurslar
      </a>
      <a href="/practice/"
        class="rounded-2xl bg-white text-slate-950 px-4 py-2 text-sm font-semibold hover:bg-slate-200 transition">
        ğŸš€ Practice
      </a>
    </div>
  </div>
</section>

<!-- UNITS -->
<div class="mt-6 space-y-4">
  {% for u in units %}
  <section class="group relative overflow-hidden rounded-3xl border border-white/10 bg-white/5 p-6
                    transition-all duration-300 hover:bg-white/10 hover:border-white/20">

    <span class="pointer-events-none absolute inset-0 opacity-0 group-hover:opacity-100 transition
                   bg-gradient-to-tr from-transparent via-white/10 to-transparent"></span>

    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
      <div>
        <div class="text-xs text-slate-400">Unit {{ u.order }}</div>
        <h2 class="text-xl md:text-2xl font-black text-white">{{ u.title }}</h2>
      </div>

      <div class="flex items-center gap-2 text-xs">
        <span class="rounded-full border border-white/10 bg-slate-950/40 px-3 py-1 text-slate-300">
          {{ u.lessons.count }} ta dars
        </span>
        <span class="rounded-full border border-white/10 bg-slate-950/40 px-3 py-1 text-slate-300">
          Unit
        </span>
      </div>
    </div>

    <!-- Lessons Tree -->
    <div class="mt-8 relative max-w-lg mx-auto">
      <!-- Vertical Line -->
      <div class="absolute left-1/2 top-4 bottom-4 w-1 bg-white/10 -ml-0.5 rounded-full"></div>

      <div class="space-y-8">
        {% for l in u.lessons.all %}
        <div class="relative flex flex-col items-center group/lesson hover:scale-105 transition-transform duration-300">

          <!-- Node -->
          <a href="{% url 'arab:lesson_detail' l.id %}"
            class="z-10 w-24 h-24 rounded-full border-4 border-slate-900 bg-gradient-to-br 
                      {% if l.user_prog and l.user_prog.is_completed %}from-emerald-500 to-emerald-600 shadow-emerald-500/40{% else %}from-slate-700 to-slate-800 shadow-slate-900/40{% endif %}
                      flex items-center justify-center shadow-lg ring-4 ring-transparent hover:ring-white/20 transition-all relative">
            <span class="text-3xl">{% if l.user_prog and l.user_prog.is_completed %}âœ…{% else %}ğŸ“š{% endif %}</span>

            {% if l.user_prog and not l.user_prog.is_completed and l.user_prog.percent > 0 %}
            <!-- Small Progress ring or text -->
            <div
              class="absolute -bottom-1 -right-1 bg-sky-500 text-[10px] font-bold px-2 py-0.5 rounded-full border-2 border-slate-900">
              {{ l.user_prog.percent }}%
            </div>
            {% endif %}
          </a>

          <!-- Popover / Label -->
          <div
            class="mt-3 text-center bg-slate-900/80 backdrop-blur-md px-4 py-2 rounded-xl border border-white/10 shadow-xl">
            <h3 class="text-white font-bold text-sm">
              {{ l.order }}. {{ l.title }}
              {% if l.videos.all %}
              <span title="Video dars" class="ml-1 text-sky-400">ğŸ¥</span>
              {% endif %}
            </h3>
            <div class="text-xs text-slate-400 mt-1">
              {% if l.user_prog and l.user_prog.is_completed %}
              <span class="text-emerald-400 font-bold uppercase tracking-wider">Tugallandi</span>
              {% else %}
              â± {{ l.estimated_minutes }} min
              {% endif %}
            </div>
          </div>

        </div>
        {% empty %}
        <div class="text-center py-6 text-slate-400 text-sm">
          Hali darslar yoâ€˜q.
        </div>
        {% endfor %}
      </div>
    </div>

  </section>
  {% empty %}
  <div class="rounded-3xl border border-white/10 bg-white/5 p-6 text-slate-300">
    Bu kursda unit yoâ€˜q.
  </div>
  {% endfor %}
</div>

<!-- Bottom hint -->
<div class="mt-8 rounded-3xl border border-white/10 bg-white/5 p-6">
  <div class="text-sm font-semibold text-white">Maslahat</div>
  <p class="mt-2 text-sm text-slate-400 leading-relaxed">
    Har bir unit boâ€˜yicha: <span class="text-slate-200">lesson â†’ practice â†’ review</span>.
    Kichik qadam bilan har kuni davom eting.
  </p>
</div>

{% endblock %}